<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Gestão de Pedido Simplificado</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container my-4">
    <h2 class="mb-4">Lista de Itens do Pedido</h2>

    <form id="formAdicionar" class="row g-3 mb-4">
      <div class="col-md-4">
        <input name="item" class="form-control" placeholder="Item" required />
      </div>
      <div class="col-md-3">
        <input name="quantidade" type="number" min="1" class="form-control" placeholder="Quantidade" required />
      </div>
      <div class="col-md-3">
        <input name="valorUnitario" type="number" min="0" step="0.01" class="form-control" placeholder="Valor Unit." required />
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Adicionar</button>
      </div>
    </form>

    <div class="table-responsive">
      <table id="tabelaPedido" class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Item</th>
            <th>Quantidade</th>
            <th>Valor Unitário (R$)</th>
            <th>Valor Total (R$)</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="4" class="text-end fw-bold">Total Geral:</td>
            <td colspan="2" id="totalGeral" class="fw-bold">R$ 0,00</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <script>
    let pedidos = [];
    let contadorId = 1;

    function formatar(valor) {
      return "R$ " + valor.toFixed(2).replace(".", ",");
    }

    function atualizarTabela() {
      const tbody = document.querySelector("#tabelaPedido tbody");
      tbody.innerHTML = "";
      let totalGeral = 0;

      pedidos.forEach(pedido => {
        const valorTotal = pedido.quantidade * pedido.valorUnitario;
        totalGeral += valorTotal;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${pedido.id}</td>
          <td>${pedido.item}</td>
          <td>${pedido.quantidade}</td>
          <td>${formatar(pedido.valorUnitario)}</td>
          <td>${formatar(valorTotal)}</td>
          <td>
            <button class="btn btn-sm btn-warning me-1" onclick="editarPedido(${pedido.id})">Editar</button>
            <button class="btn btn-sm btn-danger" onclick="excluirPedido(${pedido.id})">Excluir</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById("totalGeral").textContent = formatar(totalGeral);
    }

    document.getElementById("formAdicionar").addEventListener("submit", function(event) {
      event.preventDefault();

      const formData = new FormData(this);
      const item = formData.get("item");
      const quantidade = parseInt(formData.get("quantidade"));
      const valorUnitario = parseFloat(formData.get("valorUnitario"));

      pedidos.push({
        id: contadorId++,
        item,
        quantidade,
        valorUnitario
      });

      this.reset();
      atualizarTabela();
    });

    function editarPedido(id) {
      const pedido = pedidos.find(p => p.id === id);
      if (!pedido) return alert("Pedido não encontrado");

      const novoItem = prompt("Editar item:", pedido.item);
      if (novoItem === null) return;

      let novaQuantidade = prompt("Editar quantidade:", pedido.quantidade);
      if (novaQuantidade === null) return;
      novaQuantidade = parseInt(novaQuantidade);
      if (isNaN(novaQuantidade) || novaQuantidade < 1) {
        alert("Quantidade inválida");
        return;
      }

      let novoValor = prompt("Editar valor unitário:", pedido.valorUnitario.toFixed(2).replace('.', ','));
      if (novoValor === null) return;
      novoValor = parseFloat(novoValor.replace(',', '.'));
      if (isNaN(novoValor) || novoValor < 0) {
        alert("Valor unitário inválido");
        return;
      }

      pedido.item = novoItem;
      pedido.quantidade = novaQuantidade;
      pedido.valorUnitario = novoValor;

      atualizarTabela();
    }

    function excluirPedido(id) {
      if (confirm("Deseja realmente excluir este item?")) {
        pedidos = pedidos.filter(p => p.id !== id);
        atualizarTabela();
      }
    }

    atualizarTabela();
  </script>
</body>
</html>
